from django.core.management.base import BaseCommand
from judging.models import Criteria

class Command(BaseCommand):
    help = 'Sets up the criteria for judging'

    def handle(self, *args, **options):
        # Clear existing criteria
        Criteria.objects.all().delete()
        
        # Create main criteria
        main_criteria = [
            {
                'name': 'Основна функціональність MVP',
                'description': 'Оцінюється наявність і робота базових модулів: авторизація, профіль, CV-майстер, інтервю або тренажер, дашборд. Важливо, щоб система виглядала як цілісний продукт, який дозволяє пройти повний шлях користувача — від реєстрації до експорту результатів. Суддя враховує стабільність OAuth або альтернативної авторизації, збереження та відновлення профілю, наявність валідації у CV-майстрі, роботу таймера та звітів у тренажері, а також якість експорту CV.',
                'type': 'main',
                'max_score': 20,
            },
            {
                'name': 'Користувацький досвід і дизайн (UX/UI)',
                'description': 'Оцінюється загальне враження від використання продукту: наскільки інтерфейс зручний, логічний і приємний для користувача. Важливими є чистота візуального оформлення, контрастність, читабельність текстів, логічна навігація, адаптивність або нативний вигляд на обраній платформі.',
                'type': 'main',
                'max_score': 10,
            },
            {
                'name': 'Логіка, структура та інженерна якість',
                'description': 'Оцінюється структура коду, модульність, лаконічність рішень, повторне використання компонентів, відсутність дублювання логіки. Суддя перевіряє коректну обробку помилок, якість валідації даних, наявність безпечних методів роботи з користувацькою інформацією. Додатково враховується наявність якісного README, зрозумілих інструкцій для запуску, опису технологій та демо-сценарію.',
                'type': 'main',
                'max_score': 15,
            },
            {
                'name': 'Безпека та приватність',
                'description': 'Оцінюється дотримання вимог до приватності та обробки даних: збір лише необхідної інформації, можливість користувача видалити свій профіль, опис цілей збору даних у README. Перевіряється відсутність відкритих паролів, токенів або аналітики без згоди користувача. Позитивно оцінюються реалізації безпечного зберігання даних і механізмів стирання.',
                'type': 'main',
                'max_score': 10,
            },
            {
                'name': 'Концепція, логіка сценарію та розуміння команди',
                'description': 'Оцінюється, наскільки команда розуміє власний продукт, його мету та цінність для користувачів. Суддя звертає увагу на здатність пояснити архітектурні рішення, логіку роботи ключових компонентів, а також на продуктовий підхід — чи усвідомлюють учасники, як можна розвивати і масштабувати проєкт далі.',
                'type': 'main',
                'max_score': 10,
            },
            {
                'name': 'Повнота демо та артефакти команди',
                'description': 'Оцінюється готовність і демонстраційність проєкту. Враховується наявність README, інструкцій для входу, прикладів заповненого CV та звітів з інтервю чи тренажера. Важливо, щоб демо можна було швидко запустити та протестувати. Суддя оцінює загальне враження від демонстрації — наскільки продукт виглядає завершеним і готовим до використання.',
                'type': 'main',
                'max_score': 10,
            },
        ]
        
        # Create bonus criteria for Vector A
        bonus_a_criteria = [
            {
                'name': 'Додаткові бали для Вектора A — Мобільний застосунок',
                'description': 'Експорт CV у форматах, відмінних від PDF. Мультимовність інтерфейсу. Історія змін CV із відмітками часу. Наявність CI/CD процесу зі збіркою артефактів. Використання статичного аналізу коду і дотримання правил якості.',
                'type': 'bonus_a',
                'max_score': 15,
            },
        ]
        
        # Create bonus criteria for Vector B
        bonus_b_criteria = [
            {
                'name': 'Додаткові бали для Вектора B — Веб-застосунок',
                'description': 'Використання TypeScript замість JavaScript. Збірка desktop-версії на Tauri або Electron із готовими інсталяторами для Windows, macOS або Linux. Експорт CV у формат DOCX із використанням відповідних бібліотек. Мультимовність інтерфейсу. Історія змін CV з можливістю відкату полів.',
                'type': 'bonus_b',
                'max_score': 15,
            },
        ]
        
        # Create bonus criteria for Vector C
        bonus_c_criteria = [
            {
                'name': 'Додаткові бали для Вектора C — Telegram-бот',
                'description': 'Експорт CV у PDF безпосередньо в чаті. Мультимовність команд і повідомлень (/lang uk/en). Історія змін CV у вигляді короткого логу в /history. Реалізація Telegram WebApp для перегляду CV або дашборду. Експорт у DOCX і доставка файлу в чат.',
                'type': 'bonus_c',
                'max_score': 15,
            },
        ]
        
        # Create all criteria
        for criteria_data in main_criteria + bonus_a_criteria + bonus_b_criteria + bonus_c_criteria:
            Criteria.objects.create(**criteria_data)
            
        self.stdout.write(self.style.SUCCESS('Successfully set up criteria'))